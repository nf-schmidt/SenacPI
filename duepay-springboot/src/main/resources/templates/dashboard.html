<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>DuePay - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div th:replace="~{sidebar :: sidebar('dashboard')}"></div>

<div class="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-dark">Dashboard</h3>
        <span class="badge bg-primary rounded-pill px-3 py-2">Visão Geral</span>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card-kpi border-start border-4 border-primary">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="kpi-title text-uppercase">Clientes</div>
                        <div class="kpi-value mt-2" th:text="${totalClientes}">0</div>
                    </div>
                    <div class="icon-box bg-primary-subtle text-primary"><i class="fas fa-users fa-lg"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card-kpi border-start border-4 border-success">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="kpi-title text-uppercase">Produtos</div>
                        <div class="kpi-value mt-2" th:text="${totalProdutos}">0</div>
                    </div>
                    <div class="icon-box bg-success-subtle text-success"><i class="fas fa-box fa-lg"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card-kpi border-start border-4 border-warning">
                <div class="d-flex justify-content-between">
                    <div>
                        <div class="kpi-title text-uppercase">Faturamento Total</div>
                        <div class="kpi-value mt-2">
                            R$ <span th:text="${#numbers.formatDecimal(faturamentoTotal, 1, 'POINT', 2, 'COMMA')}">0,00</span>
                        </div>
                    </div>
                    <div class="icon-box bg-warning-subtle text-warning"><i class="fas fa-chart-line fa-lg"></i></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-md-8">
            <div class="panel h-100">
                <div class="panel-header">
                    <h5 class="fw-bold m-0"><i class="fas fa-chart-bar me-2 text-muted"></i>Faturamento Diário</h5>
                </div>
                <div th:if="${#lists.isEmpty(valoresGrafico)}" class="text-center py-5 text-muted">
                    Ainda não há dados suficientes para o gráfico.
                </div>
                <div th:unless="${#lists.isEmpty(valoresGrafico)}" class="chart-container" style="position: relative; height:300px;">
                    <canvas id="graficoVendas"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="panel h-100">
                <div class="panel-header">
                    <h5 class="fw-bold m-0"><i class="fas fa-trophy me-2 text-muted"></i>Top Produtos</h5>
                </div>

                <ul class="list-group list-group-flush">
                    <li th:if="${#lists.isEmpty(topProdutos)}" class="list-group-item text-muted text-center">
                        Nenhuma venda registrada.
                    </li>
                    <li th:each="item, stat : ${topProdutos}" class="list-group-item d-flex justify-content-between align-items-center px-0 py-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-box me-3" style="width: 35px; height: 35px;"
                                 th:classappend="${stat.index == 0} ? 'bg-warning-subtle text-warning' : 'bg-light text-muted'">
                                <i class="fas fa-crown" th:if="${stat.index == 0}"></i>
                                <i class="fas fa-hashtag" th:unless="${stat.index == 0}"></i>
                            </div>
                            <span class="fw-semibold" th:text="${item.key}">Nome do Produto</span>
                        </div>
                        <span class="badge bg-primary rounded-pill" th:text="${item.value} + ' un.'">0 un.</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /* Pega os dados do Java (Arrays) */
    var labelsDoJava = /*[[${labelsGrafico}]]*/ [];
    var dadosDoJava = /*[[${valoresGrafico}]]*/ [];

    if (labelsDoJava && labelsDoJava.length > 0) {
        const ctx = document.getElementById('graficoVendas').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labelsDoJava, // Ex: ["01/12", "02/12"]
                datasets: [{
                    label: 'Vendas (R$)',
                    data: dadosDoJava, // Ex: [150.00, 200.00]
                    backgroundColor: '#3b82f6',
                    borderRadius: 6,
                    barThickness: 30
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>